var ender = require('ender-chest').getTable('xp');
var EventEmitter = require('events');

var instance = undefined;

function initialize() {
    if (instance !== undefined) return;
    instance = new XpSystem();
    instance.emit('initialize');
}

function XpSystem() {
    EventEmitter.call(this);
    this._data = Object.create(null);
}

XpSystem.prototype.addXp = function(id, amount) {
    if (!this._data[id]) this._data[id] = 0;
    this._data[id] += amount;
    this.emit('xpadd', id, amount);
}

XpSystem.prototype.remXp = function(id, amount) {
    if (!this._data[id]) this._data[id] = 0;
    this._data[id] -= amount;
    this._data[id] > 0 ? true : this._data[id] = 0;
    this.emit('xprem', id, amount);
}

XpSystem.prototype.getXp = function(id) {
    return this._data[id];
}

EventEmitter.spigot.block.on('break', function(e) {
    if (!instance) return;
    instance.addXp(e.player.getUniqueId() + '-player', 5);
});

EventEmitter.spigot.enchantment.on('enchant', function(e) {
    if (!instance) return;
    instance.addXp(e.getEnchanter().getUniqueId() + '-player', 5);
});



module.exports = {
    initialize
}